<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body {
            font-family: Arial;
            background: #fafafa;
        }

        .menu {
            display: flex;
            gap: 20px;
            margin: 20px;
        }

        .menu button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: #4285f4;
            color: #fff;
            border-radius: 8px;
        }

        .menu button:hover {
            background: #2e6de2;
        }

        .section {
            display: none;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px #ccc;
            margin: 20px;
        }

        .active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f0f0f0;
        }

        button.action {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .lock {
            background: orange;
            color: white;
        }

        .delete {
            background: red;
            color: white;
        }
    </style>
    <script>
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        async function loadData() {
            const res = await fetch('/admin/data');
            const data = await res.json();

            // --- Ng∆∞·ªùi d√πng ---
            const userTable = `
                <table>
                    <tr><th>ID</th><th>T√™n</th><th>Quy·ªÅn</th><th>Tr·∫°ng th√°i</th><th>H√†nh ƒë·ªông</th></tr>
                    ${data.users.map(u => `
                        <tr>
                            <td>${u.id}</td>
                            <td>${u.username}</td>
                            <td>${u.role}</td>
                            <td>
                                ${u.status === 'locked'
                    ? '‚õî B·ªã kh√≥a'
                    : (u.is_active
                        ? '‚úÖ ƒêang ho·∫°t ƒë·ªông'
                        : '‚ö´ Kh√¥ng ho·∫°t ƒë·ªông')}
                            </td>
                            <td>
                                <button class="action lock" onclick="toggleUser(${u.id})">
                                    ${u.status === 'active' ? 'Kh√≥a' : 'M·ªü kh√≥a'}
                                </button>
                                <button class="action delete" onclick="deleteUser(${u.id})">X√≥a</button>
                            </td>
                        </tr>`).join('')}
                </table>`;
            document.getElementById('user-list').innerHTML = userTable;

            // --- File ---
            document.getElementById('file-list').innerHTML =
                data.files.map(f => `<p>${f.name} (${f.downloads} l∆∞·ª£t t·∫£i)</p>`).join('') || '<p>Ch∆∞a c√≥ file n√†o.</p>';
            // --- Th·ªëng k√™ ---
            document.getElementById('stats-box').innerHTML = `
                <p>T·ªïng s·ªë file: ${data.stats.file_count}</p>
                <p>T·ªïng l∆∞·ª£t t·∫£i: ${data.stats.total_downloads}</p>
                <p>T·ªïng ng∆∞·ªùi d√πng: ${data.stats.user_count}</p>`;
        }

        async function toggleUser(id) {
            await fetch('/admin/user/toggle/' + id, { method: 'POST' });
            loadData();
        }

        async function deleteUser(id) {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t√†i kho·∫£n n√†y?")) {
                await fetch('/admin/delete_user/' + id, { method: 'POST' });
                loadData();
            }
        }

        document.addEventListener("DOMContentLoaded", loadData);
    </script>
</head>

<body>
    <h1 style="text-align:center;">üëë Trang qu·∫£n tr·ªã h·ªá th·ªëng</h1>
    <div class="menu">
        <button onclick="showSection('users')">üë§ Qu·∫£n l√Ω ng∆∞·ªùi d√πng</button>
        <button onclick="showSection('files')">üìÇ Qu·∫£n l√Ω file</button>
        <button onclick="showSection('stats')">üìä Th·ªëng k√™ h·ªá th·ªëng</button>
        <a href="/logout" style="margin-left:auto; color:red;">ƒêƒÉng xu·∫•t</a>
    </div>

    <div id="users" class="section active">
        <h2>üë§ Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
        <div id="user-list">ƒêang t·∫£i...</div>
    </div>

    <div id="files" class="section">
        <h2>üìÇ Qu·∫£n l√Ω file</h2>
        <div id="file-list">ƒêang t·∫£i...</div>
    </div>

    <div id="stats" class="section">
        <h2>üìä Th·ªëng k√™ h·ªá th·ªëng</h2>
        <div id="stats-box">ƒêang t·∫£i...</div>
    </div>
</body>

</html>